# 越权漏洞
## 漏洞描述
越权访问（Broken Access Control，简称BAC）是Web应用程序中一种常见的漏洞，由于其存在范围广、危害大，被OWASP列为Web应用十大安全隐患的第二名。

该漏洞是指应用在检查授权时存在纰漏，使得攻击者在获得低权限用户账户后，利用一些方式绕过权限检查，访问或者操作其他用户或者更高权限。越权漏洞
的成因主要是因为开发人员在对数据进行增、删、改、查询时对客户端请求的数据过分相信而遗漏了权限的判定，一旦权限验证不充分，就易致越权漏洞。
## 漏洞分类
- **垂直越权**

  > 当低等级用户获得高等级的权限那么我们称之为垂直越权。
  >
  > **这里需要注意一下：垂直越权漏洞的发生条件是建立2个不同等级权限的用户必须处于同一个数据表中，否则无法实现垂直越权。**

  

- **平衡越权**

  > 同等级用户之间的越权行为。
 ## 越权的ID类型

![image](https://user-images.githubusercontent.com/71583369/145043753-9fd2a504-c6c3-476b-8998-ed5242621ffd.png)

## 越权的操作类型

  > 增加越权
  >
  > 修改越权
  >
  > 删除越权
  >
  > 查看越权

**需要注意的是每一种越权形式都需要单独性测试，有的时候存在删除越权，但不存在查看越权。**

## cookie越权
通过修改cookie中的值，来实现越权。这样说不是很清晰；举个例子，假设cookie中存在userid=1和username=test这样的值，我们可以通过修改userid和username的值，如userid=2、username=admin，来判断是否存在越权漏洞。另外账户之间的越权，也有一定几率造成垂直越权。
## 越权漏洞产生的位置

一般为商城登录的位置，收获地址之类的。多为网上商城。

## 漏洞产生的原因

通常情况下，一个 Web 程序功能流程是登录 - 提交请求 - 验证权限 - 数据库查询 - 返回结果。如果验证权限不足，便会导致越权。常见的程序都会认为通过登录后即可验证用户的身份，从而不会做下一步验证，最后导致越权。

## 漏洞防护
1. 前后端同时对用户输入信息进行校验，双重验证机制
2. 执行关键操作前必须验证用户身份，验证用户是否具备操作数据的权限
3. 特别敏感操作可以让用户再次输入密码或其他的验证信息。
4. 可以从用户的加密认证 cookie 中获取当前用户 id，防止攻击者对其修改。或在 session、cookie 中加入不可预测、不可猜解的 user 信息。
5. 直接对象引用的加密资源ID，防止攻击者枚举ID，敏感数据特殊化处理
6. 永远不要相信来自用户的输入，对于可控参数进行严格的检查与过滤










